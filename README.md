# Runtime Detector

[![npm version](https://img.shields.io/npm/v/runtime-detector.svg)](https://www.npmjs.com/package/runtime-detector)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Bundle Size](https://img.shields.io/bundlephobia/minzip/runtime-detector)](https://bundlephobia.com/package/runtime-detector)

A lightweight, type-safe runtime environment detector for JavaScript/TypeScript applications. Easily detect and handle code execution in Bun, Node.js, Deno, and Browser environments.

## üöÄ Key Features

- **Zero Dependencies**: No external dependencies for maximum reliability
- **TypeScript Ready**: Full TypeScript support with type definitions included
- **Lightweight**: Only ~7KB minified
- **Universal Detection**: Supports Bun, Node.js, Deno, and Browser environments
- **Flexible API**: Both synchronous and asynchronous operations
- **Type Safety**: Environment-specific code execution with TypeScript type checking
- **Tree-Shakeable**: Import only what you need
- **Dual Package**: Supports both ESM (MJS) and CommonJS (CJS)

## üì¶ Installation

```bash
# Using npm
npm install runtime-detector

# Using yarn
yarn add runtime-detector

# Using pnpm
pnpm add runtime-detector
```

## üìù Module Support

runtime-detector supports both ESM (ECMAScript Modules) and CommonJS formats.

```javascript
// ESM (MJS)
import { currentEnv, isNodejs } from "runtime-detector";

// CommonJS (CJS)
const { currentEnv, isNodejs } = require("runtime-detector");
```

## üéØ Quick Start

### Basic Environment Detection

```typescript
import { currentEnv, isNodejs, isBrowser } from "runtime-detector";

// Get current environment info
const { name, version, browserName } = currentEnv;

console.log(`Runtime: ${name} v${version}`);
// Example output: "Runtime: Node.js v18.15.0"

// Use boolean flags for conditional logic
if (isNodejs) {
  // Node.js specific code
}

if (isBrowser) {
  // Browser specific code
  console.log(`Browser: ${browserName}`); // e.g., "Chrome", "Firefox"
}
```

### Environment-Specific Code Execution

```typescript
import { onNodejs, onBrowser, onBun, onDeno } from "runtime-detector";

// Node.js Environment
onNodejs((env) => {
  const fs = require('fs');
  console.log(`Running in Node.js ${env.version}`);
});

// Browser Environment
onBrowser((env) => {
  const element = document.querySelector('#app');
  console.log(`Running in ${env.browserName} ${env.version}`);
});

// Bun Environment
onBun((env) => {
  const file = Bun.file('./data.txt');
  console.log(`Running in Bun ${env.version}`);
});

// Deno Environment
onDeno((env) => {
  const text = Deno.readTextFileSync('./data.txt');
  console.log(`Running in Deno ${env.version}`);
});
```

### Async Operations

```typescript
import { onNodejsAsync, onBrowserAsync } from "runtime-detector";

// Async Node.js Example
await onNodejsAsync(async (env) => {
  const response = await fetch('https://api.example.com/data');
  const data = await response.json();
  return data;
});

// Async Browser Example
await onBrowserAsync(async (env) => {
  const response = await fetch('/api/data');
  const data = await response.json();
  return data;
});
```

### Negative Conditions

```typescript
import { onNotNodejs, onNotBrowser } from "runtime-detector";

// Execute in any non-Node.js environment
onNotNodejs((env) => {
  console.log(`Running in ${env.name} (not Node.js)`);
});

// Execute in any non-Browser environment
onNotBrowser((env) => {
  console.log(`Running in ${env.name} (not Browser)`);
});
```

## üìö API Reference

### Environment Information

- `currentEnv`: Current environment details
  - `name`: Runtime name (e.g., "Node.js", "Bun")
  - `version`: Runtime version
  - `browserName`: Browser name (if applicable)

### Environment Checks

```typescript
import {
  isBrowser,  // true in browser environments
  isNodejs,   // true in Node.js
  isBun,      // true in Bun
  isDeno      // true in Deno
} from "runtime-detector";
```

### Synchronous Execution APIs

| Function                 | Description            |
| ------------------------ | ---------------------- |
| `onBrowser(callback)`    | Execute in browser     |
| `onNodejs(callback)`     | Execute in Node.js     |
| `onBun(callback)`        | Execute in Bun         |
| `onDeno(callback)`       | Execute in Deno        |
| `onNotBrowser(callback)` | Execute in non-browser |
| `onNotNodejs(callback)`  | Execute in non-Node.js |
| `onNotBun(callback)`     | Execute in non-Bun     |
| `onNotDeno(callback)`    | Execute in non-Deno    |

### Asynchronous Execution APIs

| Function                      | Description                  |
| ----------------------------- | ---------------------------- |
| `onBrowserAsync(callback)`    | Async execute in browser     |
| `onNodejsAsync(callback)`     | Async execute in Node.js     |
| `onBunAsync(callback)`        | Async execute in Bun         |
| `onDenoAsync(callback)`       | Async execute in Deno        |
| `onNotBrowserAsync(callback)` | Async execute in non-browser |
| `onNotNodejsAsync(callback)`  | Async execute in non-Node.js |
| `onNotBunAsync(callback)`     | Async execute in non-Bun     |
| `onNotDenoAsync(callback)`    | Async execute in non-Deno    |

## ü§ù Contributing

Contributions are welcome! Please feel free to submit a Pull Request.

## üìÑ License

[MIT License](LICENSE) - feel free to use this project in your applications.

---

# Runtime Detector (ÌïúÍµ≠Ïñ¥)

[![npm version](https://img.shields.io/npm/v/runtime-detector.svg)](https://www.npmjs.com/package/runtime-detector)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Bundle Size](https://img.shields.io/bundlephobia/minzip/runtime-detector)](https://bundlephobia.com/package/runtime-detector)

JavaScript/TypeScript Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖòÏùÑ ÏúÑÌïú Í≤ΩÎüâ Îü∞ÌÉÄÏûÑ ÌôòÍ≤Ω Í∞êÏßÄ ÎùºÏù¥Î∏åÎü¨Î¶¨ÏûÖÎãàÎã§. Bun, Node.js, Deno, Î∏åÎùºÏö∞Ï†Ä ÌôòÍ≤ΩÏùÑ ÏâΩÍ≤å Í∞êÏßÄÌïòÍ≥† Ï≤òÎ¶¨Ìï† Ïàò ÏûàÏäµÎãàÎã§.

## üöÄ Ï£ºÏöî Í∏∞Îä•

- **ÏùòÏ°¥ÏÑ± ÏóÜÏùå**: Ïô∏Î∂Ä ÏùòÏ°¥ÏÑ±Ïù¥ Ï†ÑÌòÄ ÏóÜÏñ¥ ÏïàÏ†ïÏ†Å
- **TypeScript ÏßÄÏõê**: ÌÉÄÏûÖ Ï†ïÏùòÍ∞Ä Ìè¨Ìï®Îêú ÏôÑÎ≤ΩÌïú TypeScript ÏßÄÏõê
- **Í≤ΩÎüâÌôî**: ÏïΩ 7KB (ÏïïÏ∂ï Ïãú)
- **Îã§ÏñëÌïú ÌôòÍ≤Ω Í∞êÏßÄ**: Bun, Node.js, Deno, Î∏åÎùºÏö∞Ï†Ä ÌôòÍ≤Ω ÏßÄÏõê
- **Ïú†Ïó∞Ìïú API**: ÎèôÍ∏∞ Î∞è ÎπÑÎèôÍ∏∞ ÏûëÏóÖ Î™®Îëê ÏßÄÏõê
- **ÌÉÄÏûÖ ÏïàÏ†ÑÏÑ±**: TypeScript ÌÉÄÏûÖ Ï≤¥ÌÅ¨ÏôÄ Ìï®Íªò ÌôòÍ≤ΩÎ≥Ñ ÏΩîÎìú Ïã§Ìñâ
- **Ìä∏Î¶¨ ÏâêÏù¥ÌÇπ**: ÌïÑÏöîÌïú Í∏∞Îä•Îßå ÏûÑÌè¨Ìä∏ Í∞ÄÎä•
- **ÎìÄÏñº Ìå®ÌÇ§ÏßÄ**: ESM(MJS)ÏôÄ CommonJS(CJS) Î™®Îëê ÏßÄÏõê

## üì¶ ÏÑ§Ïπò

```bash
# npm ÏÇ¨Ïö©
npm install runtime-detector

# yarn ÏÇ¨Ïö©
yarn add runtime-detector

# pnpm ÏÇ¨Ïö©
pnpm add runtime-detector
```

## üìù Î™®Îìà ÏßÄÏõê

runtime-detectorÎäî ESM(ECMAScript Modules)Í≥º CommonJS ÌòïÏãùÏùÑ Î™®Îëê ÏßÄÏõêÌï©ÎãàÎã§.

```javascript
// ESM (MJS)
import { currentEnv, isNodejs } from "runtime-detector";

// CommonJS (CJS)
const { currentEnv, isNodejs } = require("runtime-detector");
```

## üéØ ÏãúÏûëÌïòÍ∏∞

### Í∏∞Î≥∏ ÌôòÍ≤Ω Í∞êÏßÄ

```typescript
import { currentEnv, isNodejs, isBrowser } from "runtime-detector";

// ÌôòÍ≤ΩÎ≥Ñ ÏÑ§Ï†ï Íµ¨ÏÑ± ÏòàÏ†ú
function setupConfig() {
  const { name, version, browserName } = currentEnv;
  
  // ÌôòÍ≤ΩÎ≥Ñ Î°úÍπÖ Î†àÎ≤® Î∞è ÏÑ§Ï†ï ÏßÄÏ†ï
  const config = {
    logLevel: isNodejs ? 'verbose' : 'error',
    maxRetries: isBrowser ? 3 : 5,
    timeout: isBrowser ? 5000 : 10000,
    features: {
      cache: isNodejs || browserName === 'Chrome',
      analytics: isBrowser && browserName !== 'Firefox',
      ssr: !isBrowser
    }
  };

  return config;
}
```

### ÌôòÍ≤ΩÎ≥Ñ ÏΩîÎìú Ïã§Ìñâ

```typescript
import { onNodejs, onBrowser, onBun, onDeno } from "runtime-detector";

// Îã§ÏñëÌïú ÌôòÍ≤ΩÏóêÏÑúÏùò ÌååÏùº Ï≤òÎ¶¨
function saveData(content: string) {
  // Node.js: fs Î™®Îìà ÏÇ¨Ïö© Î∞è Ïò§Î•ò Ï≤òÎ¶¨
  onNodejs((env) => {
    const fs = require('fs').promises;
    return fs.writeFile('data.json', content)
      .catch(err => console.error(`Node.js ${env.version}ÏóêÏÑú ÌååÏùº Ïì∞Í∏∞ Ïã§Ìå®:`, err));
  });

  // Î∏åÎùºÏö∞Ï†Ä: localStorage ÏÇ¨Ïö© Î∞è Ïö©Îüâ ÌôïÏù∏
  onBrowser((env) => {
    try {
      const maxSize = 5 * 1024 * 1024; // 5MB
      if (content.length > maxSize) {
        throw new Error('localStorage Ïö©Îüâ Ï¥àÍ≥º');
      }
      localStorage.setItem('data', content);
      console.log(`${env.browserName}ÏóêÏÑú Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû• ÏôÑÎ£å`);
    } catch (err) {
      console.error('Ï†ÄÏû• Ïã§Ìå®:', err);
    }
  });

  // Bun: ÎÑ§Ïù¥Ìã∞Î∏å ÌååÏùº API ÌôúÏö©
  onBun((env) => {
    try {
      Bun.write('data.json', content);
      console.log(`Bun ${env.version}ÏóêÏÑú ÌååÏùº ÏûëÏÑ± ÏôÑÎ£å`);
    } catch (err) {
      console.error('Bun Ïì∞Í∏∞ Ïã§Ìå®:', err);
    }
  });

  // Deno: Í∂åÌïú Í¥ÄÎ¶¨ÏôÄ Ìï®Íªò ÎÑ§Ïù¥Ìã∞Î∏å API ÏÇ¨Ïö©
  onDeno((env) => {
    try {
      Deno.writeTextFileSync('data.json', content);
      console.log(`Deno ${env.version}ÏóêÏÑú ÌååÏùº ÏûëÏÑ± ÏôÑÎ£å`);
    } catch (err) {
      console.error('Deno Ïì∞Í∏∞ Ïã§Ìå®:', err);
    }
  });
}
```

### Ïò§Î•ò Ï≤òÎ¶¨Î•º Ìè¨Ìï®Ìïú ÎπÑÎèôÍ∏∞ ÏûëÏóÖ

```typescript
import { onNodejsAsync, onBrowserAsync } from "runtime-detector";

// ÌôòÍ≤ΩÎ≥Ñ ÏµúÏ†ÅÌôîÎêú API ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏
class APIClient {
  async fetchData(endpoint: string) {
    // Î∏åÎùºÏö∞Ï†Ä: ÌÉÄÏûÑÏïÑÏõÉÏù¥ ÏûàÎäî ÎÑ§Ïù¥Ìã∞Î∏å fetch ÏÇ¨Ïö©
    const browserData = await onBrowserAsync(async (env) => {
      const controller = new AbortController();
      const timeoutId = setTimeout(() => controller.abort(), 5000);
      
      try {
        const response = await fetch(endpoint, {
          headers: {
            'User-Agent': `WebApp/${env.browserName}`,
            'Accept': 'application/json'
          },
          signal: controller.signal
        });
        
        if (!response.ok) throw new Error(`HTTP ${response.status}`);
        return await response.json();
      } catch (err) {
        console.error(`Î∏åÎùºÏö∞Ï†Ä fetch Ïã§Ìå®:`, err);
        throw err;
      } finally {
        clearTimeout(timeoutId);
      }
    });

    // Node.js: axios ÏÇ¨Ïö© Î∞è Ïû¨ÏãúÎèÑ Î°úÏßÅ Íµ¨ÌòÑ
    const nodeData = await onNodejsAsync(async (env) => {
      const axios = require('axios');
      let retries = 3;
      
      while (retries > 0) {
        try {
          const response = await axios.get(endpoint, {
            headers: {
              'User-Agent': `NodeApp/${env.version}`,
              'Accept': 'application/json'
            },
            timeout: 5000
          });
          return response.data;
        } catch (err) {
          retries--;
          if (retries === 0) throw err;
          await new Promise(resolve => setTimeout(resolve, 1000));
        }
      }
    });

    return browserData || nodeData;
  }
}
```

### Í∏∞Îä• Í∞êÏßÄ Î∞è ÏµúÏ†ÅÌôî

```typescript
import { onNotNodejs, onNotBrowser } from "runtime-detector";

// Ï∫êÏãú ÏãúÏä§ÌÖú ÏµúÏ†ÅÌôî ÏòàÏ†ú
function setupCache(data: any) {
  // ÏÑúÎ≤Ñ ÌôòÍ≤ΩÏóêÏÑú Redis ÏÇ¨Ïö©
  onNotBrowser(async (env) => {
    const Redis = require('redis');
    const client = Redis.createClient();
    
    try {
      await client.connect();
      await client.set('app:cache', JSON.stringify(data));
      console.log(`Redis Ï∫êÏãúÍ∞Ä ${env.name}Ïóê ÏÑ§Ï†ïÎê®`);
    } catch (err) {
      console.error(`${env.name}ÏóêÏÑú Ï∫êÏãú ÏÑ§Ï†ï Ïã§Ìå®:`, err);
      // Î©îÎ™®Î¶¨ Ï∫êÏãúÎ°ú ÎåÄÏ≤¥
      global.__cache = data;
    }
  });

  // Î∏åÎùºÏö∞Ï†ÄÏóêÏÑú IndexedDB ÏÇ¨Ïö©
  onBrowser((env) => {
    const request = indexedDB.open('appCache', 1);
    
    request.onerror = () => {
      console.error(`${env.browserName}ÏóêÏÑú IndexedDB Ïã§Ìå®`);
      // sessionStorageÎ°ú ÎåÄÏ≤¥
      sessionStorage.setItem('cache', JSON.stringify(data));
    };

    request.onsuccess = (event: any) => {
      const db = event.target.result;
      const tx = db.transaction('cache', 'readwrite');
      tx.objectStore('cache').put(data, 'appData');
    };
  });
}
```

### Ïò§Î•ò Ï≤òÎ¶¨Î•º Ìè¨Ìï®Ìïú ÎπÑÎèôÍ∏∞ ÏûëÏóÖ

```typescript
import { onNodejsAsync, onBrowserAsync } from "runtime-detector";

// ÌôòÍ≤ΩÎ≥Ñ ÏµúÏ†ÅÌôîÎêú API ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏
class APIClient {
  async fetchData(endpoint: string) {
    // Î∏åÎùºÏö∞Ï†Ä: ÌÉÄÏûÑÏïÑÏõÉÏù¥ ÏûàÎäî ÎÑ§Ïù¥Ìã∞Î∏å fetch ÏÇ¨Ïö©
    const browserData = await onBrowserAsync(async (env) => {
      const controller = new AbortController();
      const timeoutId = setTimeout(() => controller.abort(), 5000);
      
      try {
        const response = await fetch(endpoint, {
          headers: {
            'User-Agent': `WebApp/${env.browserName}

## üìö API Î†àÌçºÎü∞Ïä§

### ÌôòÍ≤Ω Ï†ïÎ≥¥

- `currentEnv`: ÌòÑÏû¨ ÌôòÍ≤Ω ÏÉÅÏÑ∏ Ï†ïÎ≥¥
  - `name`: Îü∞ÌÉÄÏûÑ Ïù¥Î¶Ñ (Ïòà: "Node.js", "Bun")
  - `version`: Îü∞ÌÉÄÏûÑ Î≤ÑÏ†Ñ
  - `browserName`: Î∏åÎùºÏö∞Ï†Ä Ïù¥Î¶Ñ (Ìï¥ÎãπÎêòÎäî Í≤ΩÏö∞)

### ÌôòÍ≤Ω ÌôïÏù∏

```typescript
import {
  isBrowser,  // Î∏åÎùºÏö∞Ï†Ä ÌôòÍ≤ΩÏóêÏÑú true
  isNodejs,   // Node.jsÏóêÏÑú true
  isBun,      // BunÏóêÏÑú true
  isDeno      // DenoÏóêÏÑú true
} from "runtime-detector";
```

### ÎèôÍ∏∞ Ïã§Ìñâ API

| Ìï®Ïàò                     | ÏÑ§Î™Ö                          |
| ------------------------ | ----------------------------- |
| `onBrowser(callback)`    | Î∏åÎùºÏö∞Ï†ÄÏóêÏÑú Ïã§Ìñâ             |
| `onNodejs(callback)`     | Node.jsÏóêÏÑú Ïã§Ìñâ              |
| `onBun(callback)`        | BunÏóêÏÑú Ïã§Ìñâ                  |
| `onDeno(callback)`       | DenoÏóêÏÑú Ïã§Ìñâ                 |
| `onNotBrowser(callback)` | Î∏åÎùºÏö∞Ï†ÄÍ∞Ä ÏïÑÎãå ÌôòÍ≤ΩÏóêÏÑú Ïã§Ìñâ |
| `onNotNodejs(callback)`  | Node.jsÍ∞Ä ÏïÑÎãå ÌôòÍ≤ΩÏóêÏÑú Ïã§Ìñâ  |
| `onNotBun(callback)`     | BunÏù¥ ÏïÑÎãå ÌôòÍ≤ΩÏóêÏÑú Ïã§Ìñâ      |
| `onNotDeno(callback)`    | DenoÍ∞Ä ÏïÑÎãå ÌôòÍ≤ΩÏóêÏÑú Ïã§Ìñâ     |

### ÎπÑÎèôÍ∏∞ Ïã§Ìñâ API

| Ìï®Ïàò                          | ÏÑ§Î™Ö                                 |
| ----------------------------- | ------------------------------------ |
| `onBrowserAsync(callback)`    | Î∏åÎùºÏö∞Ï†ÄÏóêÏÑú ÎπÑÎèôÍ∏∞ Ïã§Ìñâ             |
| `onNodejsAsync(callback)`     | Node.jsÏóêÏÑú ÎπÑÎèôÍ∏∞ Ïã§Ìñâ              |
| `onBunAsync(callback)`        | BunÏóêÏÑú ÎπÑÎèôÍ∏∞ Ïã§Ìñâ                  |
| `onDenoAsync(callback)`       | DenoÏóêÏÑú ÎπÑÎèôÍ∏∞ Ïã§Ìñâ                 |
| `onNotBrowserAsync(callback)` | Î∏åÎùºÏö∞Ï†ÄÍ∞Ä ÏïÑÎãå ÌôòÍ≤ΩÏóêÏÑú ÎπÑÎèôÍ∏∞ Ïã§Ìñâ |
| `onNotNodejsAsync(callback)`  | Node.jsÍ∞Ä ÏïÑÎãå ÌôòÍ≤ΩÏóêÏÑú ÎπÑÎèôÍ∏∞ Ïã§Ìñâ  |
| `onNotBunAsync(callback)`     | BunÏù¥ ÏïÑÎãå ÌôòÍ≤ΩÏóêÏÑú ÎπÑÎèôÍ∏∞ Ïã§Ìñâ      |
| `onNotDenoAsync(callback)`    | DenoÍ∞Ä ÏïÑÎãå ÌôòÍ≤ΩÏóêÏÑú ÎπÑÎèôÍ∏∞ Ïã§Ìñâ     |

## ü§ù Í∏∞Ïó¨ÌïòÍ∏∞

Í∏∞Ïó¨Îäî Ïñ∏Ï†úÎÇò ÌôòÏòÅÌï©ÎãàÎã§! Pull RequestÎ•º ÏûêÏú†Î°≠Í≤å Ï†úÏ∂úÌï¥ Ï£ºÏÑ∏Ïöî.

## üìÑ ÎùºÏù¥ÏÑ†Ïä§

[MIT ÎùºÏù¥ÏÑ†Ïä§](LICENSE) - Ïó¨Îü¨Î∂ÑÏùò Ïï†ÌîåÎ¶¨ÏºÄÏù¥ÏÖòÏóê ÏûêÏú†Î°≠Í≤å ÏÇ¨Ïö©ÌïòÏã§ Ïàò ÏûàÏäµÎãàÎã§.